<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Embrace the trend">
<meta property="og:type" content="website">
<meta property="og:title" content="Shaclow&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Shaclow&#39;s Blog">
<meta property="og:description" content="Embrace the trend">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Shaclow&#39;s Blog">
<meta name="twitter:description" content="Embrace the trend">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/"/>





  <title>Shaclow's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Shaclow's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Hello,my world.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/JavaNIO(四)Scatter和Gather/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen JianLun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaclow's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/JavaNIO(四)Scatter和Gather/" itemprop="url">JavaNIO(四)Scatter和Gather</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-23T00:52:49+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>分散器 Scatter 和聚集器 Gather 分别用与从channel读取数据到buffer和 从buffer写入到channel中的方法</p>
<p>就是进行分部分分别传输的方法</p>
<p>Scatter的作用是将一个channel的数据分到三个Buffer中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer header=ByteBuffer.allocate(<span class="number">128</span>);</span><br><span class="line">ByteBuffer body=ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">ByteBuffer []bufferArray=&#123;header,body&#125;;</span><br><span class="line">channel.read(bufferArray);</span><br></pre></td></tr></table></figure>
<p>这样channel的数据就会按照数组的出现的顺序对 buffer进行依次填充，<strong>填满</strong>了就找下一个</p>
<p>Gather Write</p>
<p>就是就是多个buffer写到同一个channel中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer header = ByteBuffer.allocate(<span class="number">128</span>);</span><br><span class="line">ByteBuffer body   = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//write data into buffers</span></span><br><span class="line"></span><br><span class="line">ByteBuffer[] bufferArray = &#123; header, body &#125;;</span><br><span class="line"></span><br><span class="line">channel.write(bufferArray);</span><br></pre></td></tr></table></figure>
<p>buffer中如果你没填满数据，write到末尾，她也会切换到下一个buffer进行write</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/JavaNIO(一)Tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen JianLun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaclow's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/JavaNIO(一)Tutorial/" itemprop="url">JavaNIO(一)Tutorial</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-23T00:52:49+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>JavaNIO  的特点</p>
<p>这是给java IO  和 网络编程的一种新的IO方式</p>
<p>我们以往的IO方式可能就是和字符和字节打交道，而在NIO中 我们只和通道和缓存打交道 （channel buffer） 数据只会从一个channel到buffer或者反过来</p>
<p>NIO是无阻塞IO 你的线程可以在读取写入数据的过程中做别的，数据读写完成后再进行处理</p>
<p>NIO有个概念是selector 这是个监听器，监听多个通道的事件，比如连接打开数据到达等，然后这样每个单独的线程可以用来通过selector来监听多个通道的数据 （selector当作一个侦察兵）</p>
<p>buffer也有很多接口</p>
<ul>
<li>ByteBuffer</li>
<li>CharBuffer</li>
<li>DoubleBuffer</li>
<li>FloatBuffer</li>
<li>IntBuffer</li>
<li>LongBuffer</li>
<li>ShortBuffer</li>
</ul>
<p>这包括了你可以通过IO可以发送的数据</p>
<p><code>MappedByteBuffer</code> which is used in conjunction with memory mapped files</p>
<p>selector</p>
<p>适合通信信息量比较少的连接  这样就可以让一个线程处理多个channel的数据</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/javascript表单验证/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen JianLun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaclow's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/javascript表单验证/" itemprop="url">javascript表单验证</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-23T00:52:49+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>javascript表单验证</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"myForm"</span> <span class="attr">action</span>=<span class="string">"demo_form.php"</span> <span class="attr">onsubmit</span>=<span class="string">"return validateForm()"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- onsubmit--&gt;</span></span><br><span class="line">名字: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"fname"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Js可以访问表单中的元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validateForm</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x=<span class="built_in">document</span>.forms[<span class="string">"myForm"</span>][<span class="string">"fname"</span>];        <span class="comment">//通过name来确定具体组件</span></span><br><span class="line">    <span class="keyword">if</span>(x==<span class="literal">null</span>||x==<span class="string">""</span>)&#123;</span><br><span class="line">        alert(<span class="string">"请填入你的名字"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>表单的自动控制</p>
<p>如果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">checkValidity() 如果input元素中数据合法返回<span class="literal">true</span>否则为<span class="literal">false</span></span><br><span class="line">设置 input 元素的 validationMessage 属性，用于自定义错误提示信息的方法。</span><br><span class="line"></span><br><span class="line">使用 setCustomValidity 设置了自定义提示后，validity.customError 就会变成<span class="literal">true</span>，则 checkValidity 总是会返回<span class="literal">false</span>。如果要重新判断需要取消自定义提示，方式如下：</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"id1"</span> <span class="attr">type</span>=<span class="string">"number"</span> <span class="attr">min</span>=<span class="string">"100"</span> <span class="attr">max</span>=<span class="string">"300"</span> <span class="attr">required</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"myFunction()"</span>&gt;</span>验证<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>如果输入的数字小于 100 或大于300，会提示错误信息。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> inpObj = <span class="built_in">document</span>.getElementById(<span class="string">"id1"</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (inpObj.checkValidity() == <span class="literal">false</span>) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">"demo"</span>).innerHTML = inpObj.validationMessage;</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        d	ocument.getElementById(<span class="string">"demo"</span>).innerHTML = <span class="string">"输入正确"</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Validity-属性"><a href="#Validity-属性" class="headerlink" title="Validity 属性"></a>Validity 属性</h2><p>input 元素的 <strong>validity 属性</strong>包含一系列关于 validity 数据属性:</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>customError</td>
<td>设置为 true, 如果设置了自定义的 validity 信息。</td>
</tr>
<tr>
<td>patternMismatch</td>
<td>设置为 true, 如果元素的值不匹配它的模式属性。</td>
</tr>
<tr>
<td>rangeOverflow</td>
<td>设置为 true, 如果元素的值大于设置的最大值。</td>
</tr>
<tr>
<td>rangeUnderflow</td>
<td>设置为 true, 如果元素的值小于它的最小值。</td>
</tr>
<tr>
<td>stepMismatch</td>
<td>设置为 true, 如果元素的值不是按照规定的 step 属性设置。</td>
</tr>
<tr>
<td>tooLong</td>
<td>设置为 true, 如果元素的值超过了 maxLength 属性设置的长度。</td>
</tr>
<tr>
<td>typeMismatch</td>
<td>设置为 true, 如果元素的值不是预期相匹配的类型。</td>
</tr>
<tr>
<td>valueMissing</td>
<td>设置为 true，如果元素 (required 属性) 没有值。</td>
</tr>
<tr>
<td>valid</td>
<td>设置为 true，如果元素的值是合法的。</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/JavaNIO(三)Buffer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen JianLun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaclow's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/JavaNIO(三)Buffer/" itemprop="url">JavaNIO(三)Buffer</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-23T00:52:49+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>其实buffer本质是存储数据的一个数据块，被buffer进行包装，并且提供方法方便操作这个数据块</p>
<p>读取书写buffer根据以下步骤</p>
<ul>
<li>写数据进buffer</li>
<li>调用 buffer.flip()</li>
<li>将数据读出来</li>
<li>调用 buffer.clear() 或 buffer.compact()</li>
</ul>
<p>flip方法你可以看作是读写模式的转换</p>
<p>clear是清除所有的数据，compact是清除被读取的数据，未被读取的数据会搬到buffer的前面我们可以在这些数据后面继续写入数据到buffer中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">basicChannelTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[]args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		RandomAccessFile file=<span class="keyword">new</span> RandomAccessFile(<span class="string">"data/nio-data.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">		FileChannel inChannel=file.getChannel();</span><br><span class="line">		ByteBuffer buf=ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">		<span class="keyword">int</span> bytesRead = inChannel.read(buf);</span><br><span class="line">	    <span class="keyword">while</span> (bytesRead != -<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">	      System.out.println(<span class="string">"Read "</span> + bytesRead);</span><br><span class="line">	     <span class="comment">//important!!! 让buffer可被读</span></span><br><span class="line">	      buf.flip();</span><br><span class="line"></span><br><span class="line">	      <span class="keyword">while</span>(buf.hasRemaining())&#123;</span><br><span class="line">	          System.out.print((<span class="keyword">char</span>) buf.get());  <span class="comment">//一次读一字节的数据</span></span><br><span class="line">	      &#125;</span><br><span class="line"></span><br><span class="line">	      buf.clear();</span><br><span class="line">	      bytesRead = inChannel.read(buf);</span><br><span class="line">	    &#125;</span><br><span class="line">	    file.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前面说过buffer本质其实只是个存储块，所以实际上buffer工作状态还是考虑三个性质</p>
<ul>
<li>存储容量 capacity </li>
<li>位置 position </li>
<li>limit </li>
</ul>
<p>其实position和limit其实相当于两个block内的指针，区分buffer的能读取区域和能写入区域 position就是头指针 最大就是capacity-1  其实我们在flip其实就是在flip position指针   position会随着读取或写入而递增</p>
<p>limit指定区域的结尾只有两种情况 </p>
<ul>
<li>write mode 为capacity</li>
<li>read mode 为write mode 的 position</li>
</ul>
<h3 id="创建Buffer"><a href="#创建Buffer" class="headerlink" title="创建Buffer"></a>创建Buffer</h3><p>在创建的Buffer的时候首先要调用allocate  指定buffer的capacity  单位取决于你的Buffer形态 比如ByteBuffer 单位就是字节</p>
<p><code>ByteBuffer buf=new ByteBuffer.allocate(48);</code></p>
<h3 id="写入Buffer"><a href="#写入Buffer" class="headerlink" title="写入Buffer"></a>写入Buffer</h3><ol>
<li>通过channel进行写入 用read方法</li>
<li>自己人为添加数据 用put方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> bytesRead =inChannel.read(buffer); <span class="comment">//方法一 返回的写入buffer的字节数 可以是字符 数字等 单位看buffer</span></span><br><span class="line">buf.put(<span class="number">127</span>);  <span class="comment">//人为添加</span></span><br></pre></td></tr></table></figure>
<h3 id="从Buffer读出"><a href="#从Buffer读出" class="headerlink" title="从Buffer读出"></a>从Buffer读出</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> byteWritten=inChannel.write(buffer);</span><br><span class="line"><span class="keyword">byte</span> bb=buf.get();</span><br></pre></td></tr></table></figure>
<p>注 get有多个重载方法，支持你各种不同的读法，上述是老老实实一个byte一个byte读</p>
<p>buffer的rewind方法可以让你的position回到0 这样你可以重新从buffer进行读取数据 应该对写入没有用口巴</p>
<p>mark和reset方法给posittion进行标记，到时就可以调用reset回到这里</p>
<p>equals  compareTo 比较</p>
<p>都是比较剩余的字符 从第一个字符开始比较 </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/JavaNIO(七)SocketChannel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen JianLun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaclow's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/JavaNIO(七)SocketChannel/" itemprop="url">JavaNIO(七)SocketChannel</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-23T00:52:49+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SocketChannel socketChannel=SocketChannel.open();</span><br><span class="line">socketChannel.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"http://xxxx.com"</span>),<span class="number">80</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭SocketChannel </span></span><br><span class="line">socketChannel.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">//从Socketchannel获取数据</span></span><br><span class="line">ByteBuffer buf=ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"><span class="keyword">int</span> bytesRead=socketChannel.read(buf);   <span class="comment">//返回你读取的数目</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//写入</span></span><br><span class="line">String newData=<span class="string">"kinkin牛逼"</span>;</span><br><span class="line">ByteBuffer buffer=ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">buffer.clear();</span><br><span class="line">buffer.put(newData.getBytes());</span><br><span class="line">buffer.flip();</span><br><span class="line"><span class="keyword">while</span>(buffer.hasRemaining())&#123;</span><br><span class="line">    channel.write(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SocketChannel的 no-blocking</p>
<p>你可以使用connect这个方法可能会返回一个连接，可以通过finishConnect进行判断    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">socketChannel.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"http://jenkov.com"</span>, <span class="number">80</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(! socketChannel.finishConnect() )&#123;</span><br><span class="line">    <span class="comment">//wait, or do something else...    </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>non-blocking下的SocketChannel </p>
<p>write 和read可能会在没有写入或读取字节的情况下就返回，这个时候</p>
<ul>
<li>write方法需要一个loop </li>
<li>read方法需要注意它返回的int值来判断读取是否完成</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/JavaNIO(六)Selector/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen JianLun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaclow's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/JavaNIO(六)Selector/" itemprop="url">JavaNIO(六)Selector</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-23T00:52:49+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>选择器能减少你线程的启用 这会节省cpu的资源和时间，虽然现在操作系统的并行能力变强，多线程能充分利用它的功能</p>
<ul>
<li><p>创建selector  <code>Selector selector=Selector.open()</code></p>
</li>
<li><p>给selector注册channels </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">SelectionKey key = channel.register(selector, SelectionKey.OP_READ);</span><br></pre></td></tr></table></figure>
<p>首先channel一定要变成不阻塞模式来给selector后续使用，这意味着你不能将FileChannel交给selector因为这个不能变成no-blocking模式 socketChannel可以</p>
<p>我们看到register的参数二 代表selector要倾听的事件 </p>
<ol>
<li>Connect   channel成功连接到其他服务器</li>
<li>Accept  socket channel 接受了一个到来的连接</li>
<li>Read  channel的数据准备被读取</li>
<li>Write  channel的数据准备去写入</li>
</ol>
<p>事件发生的时候是意味着ready 这些事件就用SelectionKey去表示</p>
<ol>
<li>SelectionKey.OP_CONNECT</li>
<li>SelectionKey.OP_ACCEPT</li>
<li>SelectionKey.OP_READ</li>
<li>SelectionKey.OP_WRITE</li>
</ol>
<p>如果你要监听多个事件可以</p>
<p><code>int interestSet=SelectionKey.OP_CONNECT| SelectionKey.OP_WRITE</code></p>
</li>
</ul>
<p>然后我们看到register方法返回了一个 SelectionKey 这个对象的提供的信息很多</p>
<ul>
<li>The interest set</li>
<li>The ready set</li>
<li>The Channel</li>
<li>The Selector</li>
<li>An attached object (optional)</li>
</ul>
<p>注意下面的所谓的selectionKey 或者 SelectionKey 应该只是SelectionKey的一个对象</p>
<p>InterestSet代表你之前选择的监听事件的爱好的集合，你可以通过以下方式来进行判断</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> interestSet = selectionKey.interestOps();</span><br><span class="line"><span class="comment">//通过 与运算符进行逐个判断</span></span><br><span class="line"><span class="keyword">boolean</span> isInterestedInAccept  = interestSet &amp; SelectionKey.OP_ACCEPT;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInConnect = interestSet &amp; SelectionKey.OP_CONNECT;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInRead    = interestSet &amp; SelectionKey.OP_READ;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInWrite   = interestSet &amp; SelectionKey.OP_WRITE;</span><br></pre></td></tr></table></figure>
<p>ReadySet是用来返回你的channel准备好的事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> readySet = selectionKey.readyOps();</span><br><span class="line"><span class="comment">//然后剩下的操作和上面一样</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//或者可以通过方法直接获得</span></span><br><span class="line">selectionKey.isAcceptable();</span><br><span class="line">selectionKey.isConnectable();</span><br><span class="line">selectionKey.isReadable();</span><br><span class="line">selectionKey.isWritable();</span><br></pre></td></tr></table></figure>
<p>Channel和Selector这两个其实并不重要，但仍可以获得</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Channel  channel  = selectionKey.channel();</span><br><span class="line">Selector selector = selectionKey.selector();</span><br></pre></td></tr></table></figure>
<p>Attaching object 这个是和SelectionKey的关联对象  类似寄存物件那样？的东西</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">selectionKey.attach(theObject);</span><br><span class="line">Object attachObj=selectionKey.attachment();</span><br><span class="line"></span><br><span class="line"><span class="comment">//你也可以register的使用就将Obj加上去了</span></span><br><span class="line">SelectionKey key=channel.register(selector,SelectionKey.OP_READ,theObject);</span><br></pre></td></tr></table></figure>
<p>通过Selector来进行channel的选择  终于到了重头戏了</p>
<p>Selector方法</p>
<p>首先介绍三个select家族的方法</p>
<ul>
<li>int select()  用来判断你注册在这个selector的的channel哪个有ready事件了  一直阻塞直到有</li>
<li>int select(long timeout)   和上面一样，但其只在一定时间内阻塞</li>
<li>int selectNow()  现在进行select 无论是否有channel ready 它都返回不阻塞</li>
</ul>
<p>注意这些select只计算距离上一个select中新增加的ready的channel 上一个select就有而且没被处理的ready channel不被计算内</p>
<p>一旦你select方法知道有准备好的channel了 然后就可以调用selectedKeys() 去返回准备好的channel了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;SelectionKey&gt;selectionkeys=selector.selectedKeys();</span><br></pre></td></tr></table></figure>
<p>其实我们发现register方法好像也会返回这些SelectionKey对象 但它只是表示和这个selector有注册关系了，你可以获取所有的这些keys通过 selectedKeySet()方法  但可能是有些方法是不全的？个人猜测比如成功的事件的判断估计都为false</p>
<p>我们可以通过遍历去处理所有准备好的channel</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;SelectionKey&gt;selectedKeys=selector.selectedKeys();</span><br><span class="line">Iterator&lt;SelectionKey&gt;keyIterator=selectedKeys.iterator();</span><br><span class="line"><span class="keyword">while</span>(keyIterator.hasNext())&#123;</span><br><span class="line">    SelectionKey key=keyIterator.next();</span><br><span class="line">    <span class="keyword">if</span>(key.isAcceptable())&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(key.isConnectable())&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">        <span class="comment">// a channel is ready for reading</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123;</span><br><span class="line">        <span class="comment">// a channel is ready for writing</span></span><br><span class="line">    &#125;</span><br><span class="line">	keyIterator.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意最后一定要将这个实例进行删除，因为这个selector不会删除selectionKey的实例  要主动删除</p>
<p>wakeup方法</p>
<p>实际上这个select方法 wakeUp() 是通过线程来调用的，但是呢有时候硬是没有新的ready channel这时候就会造成阻塞，</p>
<p>这时候能通过另外一个未被阻塞的线程调用 <code>selector.wakeup()</code>让阻塞的select（<strong>如果多个线程阻塞,事实上wakeup只能让正在阻塞的一个线程返回</strong>）放过，如果没有线程 如果wakeup的时候没有线程，它就会让下一个call select 的线程立刻唤醒（大概率是得不到想要的结果的</p>
<p>close方法</p>
<p>当你用完这个Selector 你就调用call方法，这会让所有的绑定在Selector上的SelectedKey无效， 但channel本身不会被删除</p>
<p>综合例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Selector selector = Selector.open();  <span class="comment">//创建 selector</span></span><br><span class="line"></span><br><span class="line">channel.configureBlocking(<span class="keyword">false</span>);   <span class="comment">//更改channel的模式 no-blocking</span></span><br><span class="line"></span><br><span class="line">SelectionKey key = channel.register(selector, SelectionKey.OP_READ);  <span class="comment">//channel 注册</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> readyChannels = selector.select();<span class="comment">// select方法 判断是否有ready channel</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(readyChannels == <span class="number">0</span>) <span class="keyword">continue</span>;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys(); <span class="comment">//取得ready channel</span></span><br><span class="line"></span><br><span class="line">  Iterator&lt;SelectionKey&gt; keyIterator = selectedKeys.iterator();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(keyIterator.hasNext()) &#123;  <span class="comment">//遍历</span></span><br><span class="line"></span><br><span class="line">    SelectionKey key = keyIterator.next();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(key.isAcceptable()) &#123;</span><br><span class="line">        <span class="comment">// a connection was accepted by a ServerSocketChannel.</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isConnectable()) &#123;</span><br><span class="line">        <span class="comment">// a connection was established with a remote server.</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">        <span class="comment">// a channel is ready for reading</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123;</span><br><span class="line">        <span class="comment">// a channel is ready for writing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    keyIterator.remove();   <span class="comment">//从Set中删除这个SelectionKey实例</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/JavaNIO(二)Channel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen JianLun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaclow's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/JavaNIO(二)Channel/" itemprop="url">JavaNIO(二)Channel</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-23T00:52:49+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h2><p>channel你可以同时读入或写入数据 而流只能做其中一项</p>
<p>channel可以异步读入或写入数据</p>
<p>channel的数据总是从buffer来</p>
<p>channel有点像stream 然后接口有三个</p>
<ul>
<li>FileChannel  文件IO</li>
<li>DatagramChannel   UDPIO</li>
<li>SocketChannel  TCPIO</li>
<li>ServerSocketChannel　　监听连接然后产生SocketChannel</li>
</ul>
<p>主要是net 和file IO </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">basicChannelTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[]args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		RandomAccessFile file=<span class="keyword">new</span> RandomAccessFile(<span class="string">"data/nio-data.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">		FileChannel inChannel=file.getChannel();</span><br><span class="line">		ByteBuffer buf=ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">		<span class="keyword">int</span> bytesRead = inChannel.read(buf);</span><br><span class="line">	    <span class="keyword">while</span> (bytesRead != -<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">	      System.out.println(<span class="string">"Read "</span> + bytesRead);</span><br><span class="line">	     <span class="comment">//important!!!</span></span><br><span class="line">	      buf.flip();</span><br><span class="line"></span><br><span class="line">	      <span class="keyword">while</span>(buf.hasRemaining())&#123;</span><br><span class="line">	          System.out.print((<span class="keyword">char</span>) buf.get());</span><br><span class="line">	      &#125;</span><br><span class="line"></span><br><span class="line">	      buf.clear();</span><br><span class="line">	      bytesRead = inChannel.read(buf);</span><br><span class="line">	    &#125;</span><br><span class="line">	    file.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先先将数据读入bytebuffer中，然后再System.out出来 记住一定要flip！！！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/hibernate学习(四)持久化类属性的注释/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen JianLun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaclow's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/hibernate学习(四)持久化类属性的注释/" itemprop="url">hibernate学习(四)持久化类属性的注释</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-23T00:52:49+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>javax.persistence 和 org.hibernate.annotion的包的注释的区别</p>
<p>@Generated一定要用hibernate包的</p>
<p>@Column</p>
<p>ColumnDefinition 是用来定义属性的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Column</span>(name=<span class="string">"chinesename"</span>,columnDefinition=<span class="string">"varchar(128),not null,unique,updateable"</span>)</span><br><span class="line"> <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="comment">//等效为这样</span></span><br><span class="line"> <span class="meta">@Column</span>(length=<span class="number">253</span>,name=<span class="string">"englishname"</span>,nullable=<span class="keyword">false</span>,unique=<span class="keyword">true</span>,updatable=<span class="keyword">true</span>,insertable=<span class="keyword">false</span>)</span><br><span class="line"> <span class="keyword">private</span> String name2;</span><br></pre></td></tr></table></figure>
<p>看起来columnDefinition可以替代，其实不然，有时候需要长文本，而String只会定义为varchar这时候需要你</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Column</span>(name=<span class="string">"xxx"</span>,columnDefinition=<span class="string">"text"</span>)</span><br></pre></td></tr></table></figure>
<p>scale precision 使用于 decimal类型 对应java的 BigDecimal 大数型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Column</span>(name=<span class="string">"xxx"</span>,precision=<span class="number">5</span>,scale=<span class="number">2</span>)</span><br><span class="line"><span class="keyword">private</span> BigDecimal salary1;</span><br><span class="line"><span class="comment">//相当于</span></span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"xx"</span>,columnDefinition=<span class="string">"decimal(5,2)"</span>)</span><br><span class="line"><span class="keyword">private</span> BigDecimal salary2;</span><br></pre></td></tr></table></figure>
<p>precision 代表有效数字 scale代表支持的小数的位数</p>
<p>1.double类型将在数据库中映射为double类型，precision和scale属性无效<br>2.double类型若在columnDefinition属性中指定数字类型为decimal并指定精度，则最终以columnDefinition为准</p>
<p>还有insertable length(大概和varchar有关) nullable unique updateable</p>
<p>insertable真的要留意 false就对插入免疫了变成null</p>
<p>table指定该列所属表名 当需要多个表来保存一个实体时要用到</p>
<p>@Access 和对整个实体使用的方法一样，注解属性是单独改变该属性的访问策略</p>
<p> hibernate 的@Column注解在的字段上不生效</p>
<p>@Column的作用范围是根据@Id的作用范围来的，即如果@Id标签放在字段上的，那么@Column就只能作用在字段上，如果@Id放在getter方法上的，那么@Column也得放到getter上。</p>
<p>org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions Table ‘hibernatetest.cars_inf’ doesn’t exist</p>
<p>两种情况 一种是你没生成数据库 比如说没在cfg文件上调什么update然后数据库本身也没生成这样的表</p>
<p>或者你create 了 table但你create失败，就是你语法错误或者方言版本太低的问题</p>
<p>有时候表已经生成你再修改映射类没用，除非你配置文件是create 这时候要手动删除数据表</p>
<p>@Formula(value=”(sql语句)”) 就是顾名思义就是通过数据库生成数据，动态计算属性值，所以不会保存在数据库中，数据库也不会出现相应列</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Formula</span>(value=<span class="string">"(select car.amount*car.price from cars_inf car where car.id=id)"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer totalPrice;</span><br></pre></td></tr></table></figure>
<p>这个就是将表中的两列相乘</p>
<p>注意 Formula的表达式中 可以直接使用参数 where car.id=id  id就是参数，会将持久化对象的id属性当参数传入</p>
<p>蛋疼的一点是这个值不是立刻能取得的，你插入对象的时候你是得不到这个计算值的，即使你commit事务以后调用get方法也得不到，必须是要重新get/load才能调用get去计算获得值</p>
<p>介绍@Generated之前  @Generated 和@Formual有异曲同工之妙，但它是控制数据库生成，也就是控制数据库的触发器</p>
<p>首先要现在数据库准备好触发器 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter |</span><br><span class="line">create trigger full_content2 before update on cars_inf</span><br><span class="line">for each row </span><br><span class="line">begin</span><br><span class="line">	set new.fullname = concat(new.chinesename,new.englishname);</span><br><span class="line">end;</span><br><span class="line">|</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<p>这个触发器学了就忘很烦，简单解释一下  首先一个表上最多建立6个触发器 insert/update/delete * after/before</p>
<ul>
<li>Insert型触发器：可能通过insert语句，load data语句，replace语句触发；</li>
<li>Update型触发器：可能通过update语句触发；</li>
<li>Delete型触发器：可能通过delete语句，replace语句触发</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create trigger triggerName </span><br><span class="line">after/before insert/update/delete on 表名 </span><br><span class="line">for each row #这句话在mysql是固定的 </span><br><span class="line">begin </span><br><span class="line"> sql语句; </span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<p>MySQL 中定义了 NEW 和 OLD，用来表示触发器的所在表中，触发了触发器的那一行数据。</p>
<p>在 INSERT 型触发器中，NEW 用来表示将要（BEFORE）或已经（AFTER）插入的新数据；<br>在 UPDATE 型触发器中，OLD 用来表示将要或已经被修改的原数据，NEW 用来表示将要或已经修改为的新数据；<br>在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；<br>使用方法： NEW.columnName （columnName 为相应数据表某一列名） </p>
<p>另外，<strong>OLD 是只读的，而 NEW 则可以在触发器中使用 SET 赋值，这样不会再次触发触发器，造成循环调用。</strong></p>
<p>然后指定为 @Generated(value=GenerationTime.xxx)</p>
<p>有三种 ALWAYS/NEVER/INSERT </p>
<ul>
<li>NEVER就相当于没设置这个东西</li>
<li>执行一条insert时（INSERT/ALWAYS）或 update(ALWAYS) 执行 hibernate会立刻执行一条select语句去获得该数据列的值，并将该值赋给该持久化的对象</li>
</ul>
<p>实际上，我觉得正常来说是需要insert和update两个触发器得</p>
<p>有个感觉没什么用的东东</p>
<p>@Transient 代表临时属性</p>
<p>枚举注释</p>
<p>@Enumerated 用来修饰枚举enum  value</p>
<ul>
<li>EnumType.STRING 表示数据库中存储的是字符串</li>
<li>EnumType.ORDINAL 表示数据库中存储的是枚举的序号</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/JavaNIO(八)ServerSocketChannel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen JianLun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaclow's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/JavaNIO(八)ServerSocketChannel/" itemprop="url">JavaNIO(八)ServerSocketChannel</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-23T00:52:49+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line"></span><br><span class="line"><span class="comment">//他的socket要绑定InetSocketAddress</span></span><br><span class="line">serverSocketChannel.socket().bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">    SocketChannel socketChannel =</span><br><span class="line">            serverSocketChannel.accept();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//do something with socketChannel...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">serverSocketChannel.close();</span><br></pre></td></tr></table></figure>
<p>NON-BLOCKING模式 </p>
<p>由于Accept是立刻返回的所以有可能是返回null 所以必须要自己检查一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line"></span><br><span class="line">serverSocketChannel.socket().bind(new InetSocketAddress(9999));</span><br><span class="line">serverSocketChannel.configureBlocking(false);</span><br><span class="line"></span><br><span class="line">while(true)&#123;</span><br><span class="line">    SocketChannel socketChannel =</span><br><span class="line">            serverSocketChannel.accept();</span><br><span class="line"></span><br><span class="line">    if(socketChannel != null)&#123;</span><br><span class="line">        //do something with socketChannel...</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/hibernate学习(三)持久化类的注释/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen JianLun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shaclow's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/hibernate学习(三)持久化类的注释/" itemprop="url">hibernate学习(三)持久化类的注释</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-23T00:52:49+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这个注释感觉有点复杂</p>
<p>分成两个部分好了 一个是对表的注释一个是对里面属性的注释</p>
<p>一个PO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>    <span class="comment">//代表这个是一个实例</span></span><br><span class="line"><span class="meta">@Access</span>(value = AccessType.PROPERTY)  </span><br><span class="line"><span class="comment">//代表这个访问属性方式是用get/set方法 不是直接操作成员变量（AccessType.Field）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"books_inf"</span>,uniqueConstraints=<span class="meta">@UniqueConstraint</span>(columnNames = &#123; <span class="string">"price"</span> &#125;),indexes=&#123;<span class="meta">@Index</span>(name=<span class="string">"name_index"</span>, columnList = <span class="string">"price"</span>,unique=<span class="keyword">false</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@DynamicUpdate</span>(value=<span class="keyword">true</span>)</span><br><span class="line"><span class="comment">//默认为false update语句是否动态生成，更新那些改变过的字段（代价是需要更多时间去生成sql）</span></span><br><span class="line"><span class="meta">@OptimisticLocking</span>(type=OptimisticLockType.VERSION)</span><br><span class="line"><span class="meta">@SelectBeforeUpdate</span>(value=<span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@Where</span>(clause=<span class="string">"id=3"</span>)</span><br><span class="line"><span class="comment">//每个查询加载语句后一定有 clause加上的条件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String bookname;</span><br><span class="line">	<span class="keyword">private</span> Integer price;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getBookname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> bookname;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> price;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(Integer price)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.price = price;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBookname</span><span class="params">(String bookname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.bookname = bookname;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table</span>(name=<span class="string">"books_inf"</span>,uniqueConstraints=<span class="meta">@UniqueConstraint</span>(columnNames = &#123; <span class="string">"price"</span> &#125;),indexes=&#123;<span class="meta">@Index</span>(name=<span class="string">"name_index"</span>, columnList = <span class="string">"price"</span>,unique=<span class="keyword">false</span>)&#125;)</span><br></pre></td></tr></table></figure>
<p>Table注解的 name 代表数据库名字 uniqueConstraints（里面的columnnames是一个字符串数组，指定多个列都有唯一索引） 和indexes差不多都是索引  </p>
<p>不过uniqueConstraints是唯一索引，就是unique是true  所以@Index也可以做到 uniqueConstraint的样子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptimisticLocking</span>(type=OptimisticLockType.VERSION)</span><br><span class="line"><span class="meta">@SelectBeforeUpdate</span>(value=<span class="keyword">false</span>)</span><br></pre></td></tr></table></figure>
<p>在打开DynamicUpdate之后金额图指定乐观锁@OptimisticLocking 乐观锁就是</p>
<p>悲观锁，正如其名，它指的是对数据被外界（包括本系统当前的其他事务，以及来自外部系统的事务处理）修改持保守态度(悲观)，因此，在整个数据处理过程中，将数据处于锁定状态。大家要拿到锁才能进行数据访问操作 悲观锁的实现，往往依靠数据库提供的锁机制 （也只有数据库层提供的锁机制才能真正保证数据访问的排他性，否则，即使在本系统中实现了加锁机制，也无法保证外部系统不会修改数据）</p>
<p>安全但降低并行性而且慢且增加死锁的情况</p>
<p>乐观锁（ Optimistic Locking ） 相对悲观锁而言，乐观锁假设认为数据一般情况下不会造成冲突，所以在数据进行提交更新的时候，才会正式对数据的冲突与否进行检测，如果发现冲突了，则让返回用户错误的信息，让用户决定如何去做。</p>
<p>乐观锁相信事务之间的数据竞争(data race)的概率是比较小的，因此尽可能直接做下去，直到提交的时候才去锁定， 如果直接简单这么做，还是有可能会遇到不可预期的结果，例如两个事务都读取了数据库的某一行，经过修改以后写回数据库，这时就遇到了问题，他就返回错误信息，让用户决定做法</p>
<p>倘若出现错误代码将在tx.commit()处抛出<strong>StaleObjectStateException</strong>异 常，并指出版本检查失败，</p>
<p>@OptimisticLocking有多个策略</p>
<ul>
<li>OptmisticLockType<ul>
<li>Version 检查version/timestamp</li>
<li>ALL 检查所有字段</li>
<li>DIRTY 检查要更新的字段</li>
<li>NONE 不使用</li>
</ul>
</li>
</ul>
<p>所谓检查字段，就是先select一下，然后将实体更改update时，看当前的字段有没有变化，最简单的就是version，提供version字段，修改后就version+=1 用于识别是否更改</p>
<p>所以好像要添加一个字段 然后注释@version</p>
<p>@Check </p>
<ul>
<li>constraints=”xx”   check约束条件</li>
</ul>
<p>@Subselect这个比较特别 用了这个说明是将这个对象用来存放视图 不能修改只能读取</p>
<ul>
<li>指明实际使用的的sql语句 然后将每一列都安排到相应的属性上（应该是每个属性都对应一个列）然后就可以通过这个类去做访问了，但只读不能写，写了无法保存数据库</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"test_summary"</span>)</span><br><span class="line"><span class="meta">@Subselect</span>(<span class="string">"SELECT i.name AS itemName, MAX(b.amount) AS amountMax, COUNT(*) AS itemCount "</span></span><br><span class="line">		+ <span class="string">"FROM test_item i "</span></span><br><span class="line">		+ <span class="string">"INNER JOIN test_bid b ON i.item_id = b.id "</span></span><br><span class="line">		+ <span class="string">"GROUP BY i.name"</span>)</span><br><span class="line"><span class="meta">@Synchronize</span>( &#123; <span class="string">"test_item"</span>, <span class="string">"test_bid"</span> &#125;)</span><br><span class="line"><span class="comment">// tables impacted</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Summary</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3647575276389635849L</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@Column</span>(name = <span class="string">"itemName"</span>)</span><br><span class="line">	<span class="keyword">private</span> String itemName;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Column</span>(name = <span class="string">"amountMax"</span>)</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> amountMax;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Column</span>(name = <span class="string">"itemCount"</span>)</span><br><span class="line">	<span class="keyword">private</span> Integer itemCount;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Summary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Summary</span><span class="params">(String itemName, <span class="keyword">double</span> amountMax, Integer itemCount)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.itemName = itemName;</span><br><span class="line">		<span class="keyword">this</span>.amountMax = amountMax;</span><br><span class="line">		<span class="keyword">this</span>.itemCount = itemCount;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getItemName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> itemName;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItemName</span><span class="params">(String itemName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.itemName = itemName;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getAmountMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> amountMax;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAmountMax</span><span class="params">(<span class="keyword">double</span> amountMax)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.amountMax = amountMax;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> itemCount;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItemCount</span><span class="params">(Integer itemCount)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.itemCount = itemCount;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = <span class="keyword">null</span>;</span><br><span class="line">		Transaction tx = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			session = HibernateUtil.getSession();</span><br><span class="line">			tx = session.beginTransaction();</span><br><span class="line"> </span><br><span class="line">			String hql = <span class="string">"from Summary"</span>;     <span class="comment">//接实例类</span></span><br><span class="line">			Query query = session.createQuery(hql);</span><br><span class="line">			List&lt;Summary&gt; list = query.list();</span><br><span class="line">			<span class="comment">// System.out.println(list.size());</span></span><br><span class="line">			<span class="keyword">for</span> (Summary summary : list) &#123;</span><br><span class="line">				System.out.println(summary.getItemName() + <span class="string">"\t"</span></span><br><span class="line">						+ summary.getAmountMax() + <span class="string">"\t"</span></span><br><span class="line">						+ summary.getItemCount());</span><br><span class="line">			&#125;</span><br><span class="line">			tx.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (HibernateException e) &#123;</span><br><span class="line">			<span class="keyword">if</span> (tx.isActive()) &#123;</span><br><span class="line">				tx.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>@BatchSize 单次抓取的实体的数量</p>
<p>@PolymorphismType 用来指定隐式多态查询 比如访问父类就是操控他的实际子类什么的</p>
<p> @DynamicUpdate     动态修改，它会判断持久化对象中属性，哪些属性值发生了改变就会生成update的语句。(持久化状态下做修改)     </p>
<p>@SelectBeforeUpdate   修改之前先查询，查询得到持久化对象再与脱管状态下的对象进行比较,哪些属性值发生了改变就会生成update的语句。(脱管状态下做修改)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"books_inf"</span>,uniqueConstraints=<span class="meta">@UniqueConstraint</span>(columnNames = &#123; <span class="string">"amount"</span> &#125;),indexes=&#123;<span class="meta">@Index</span>(name=<span class="string">"price_index"</span>, columnList = <span class="string">"price"</span>,unique=<span class="keyword">false</span>)&#125;)</span><br><span class="line"><span class="meta">@DynamicUpdate</span>(value=<span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@OptimisticLocking</span>(type=OptimisticLockType.VERSION)</span><br><span class="line"><span class="meta">@SelectBeforeUpdate</span>(value=<span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@Where</span>(clause=<span class="string">"price=233"</span>)</span><br><span class="line"><span class="meta">@Check</span>(constraints = <span class="string">"id&gt;0"</span>)</span><br><span class="line"><span class="meta">@Access</span>(value = AccessType.PROPERTY)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String bookname;</span><br><span class="line">	<span class="keyword">private</span> Integer price;</span><br><span class="line">	<span class="keyword">private</span> Integer amount;</span><br><span class="line">	<span class="meta">@Version</span></span><br><span class="line">	<span class="keyword">private</span> Integer version;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有个很奇怪的一点，发现好像同时加了index和uniqueconstraints之后 它就会报错说没有主键，但我已经在id上标好@Id和@GeneratedValue <strong>此时就要在getId方法上加上@Id  而且还要给上相应的GeneratedValue</strong> </p>
<p>注意load/get方法去获取实体对象的时候</p>
<p>会使用select语句 这时候@Where的条件就会使用，这时候如果没select到可能就得不到相应的对象了，但我感觉更新应该是一样的。</p>
<p>发现两个很骚的东西</p>
<p>好像hibernate的操作必须要放在事务中，不放在事务中就不会实现</p>
<p>还有DynamicUpdate 的确是只会更新修改过的字段，相同的字段是不会放入update中的，</p>
<p><del>倘若都一样不会生成update语句 而且好像如果不是动态生成的update是不会显示在tomcat中的</del></p>
<p>Selectbeforeupdate有异曲同工之妙，它是用于脱管对象的重新更新，所以它会先生成select语句，然后将只会update修改过的字段</p>
<p>若没有这两个注释 update就会全部字段都会update</p>
<p>OptimisticLocking 情况一样不乐观 改变不了</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Chen JianLun</p>
              <p class="site-description motion-element" itemprop="description">Embrace the trend</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">59</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chen JianLun</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
